<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>전화상담도우미 - 건조기</title>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"
  />
  <link rel="stylesheet" href="css/installation_boiler2.css" />

  <!-- ✅ 공용 기록 JS -->
  <script src="js/app.js" defer></script>
</head>

<body>
  <main class="page">
    <aside class="history" aria-label="선택 기록">
      <div class="history-head">
        <h2 class="history-title">선택 기록</h2>
        <button type="button" class="history-clear">지우기</button>
      </div>

      <ul class="history-list"></ul>
      <p class="history-hint">이전 단계 선택이 저장됩니다.</p>
    </aside>

    <div class="container">
      <header class="logo-area">
        <a href="mobile.html">
          <img src="img/logo.png" alt="SUNDOO" class="logo" />
        </a>
      </header>

      <main class="content">
        <h1 class="title">전화 상담 도우미</h1>

        <div class="subtitle-row">
          <p class="subtitle">건조기 설치 타입을 선택해주세요.</p>
          <button type="button" class="prev-btn" id="prevBtn">이전으로</button>
        </div>

        <div class="button-wrap">
          <button class="type-btn active" data-type="new">도시</button>
          <button class="type-btn" data-type="replace">LPG</button>
        </div>
      </main>
    </div>
  </main>

  <script>
    const buttons = document.querySelectorAll(".type-btn");
    const prevBtn = document.getElementById("prevBtn");

    const PRICE_KEY = "install_price";
    const HISTORY_KEY = "sundoo_selection_history";

    // ✅ 단계별 extra 키(꼬임 방지용)
    const PRODUCT_EXTRA_KEY = "dryer_product_extra";
    const HOLE_EXTRA_KEY = "dryer_hole_extra";
    const CHIMNEY_EXTRA_KEY = "dryer_chimney_extra";

    function pushHistory(label, url) {
      try {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
        history.push({ label, url, ts: Date.now() });
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history.slice(-30)));
      } catch {}
    }

    function toNum(v) {
      const n = Number(v);
      return Number.isFinite(n) ? n : 0;
    }

    function calcTotal() {
      const product = toNum(localStorage.getItem(PRODUCT_EXTRA_KEY));
      const hole = toNum(localStorage.getItem(HOLE_EXTRA_KEY));
      const chimney = toNum(localStorage.getItem(CHIMNEY_EXTRA_KEY));
      return Math.max(0, product + hole + chimney);
    }

    // ✅ 1번 페이지 진입 시, 건조기 상담 흐름을 "새로 시작"한다면 여기서 초기화
    //    (원치 않으면 아래 4줄만 주석 처리하면 됨)
    localStorage.setItem(PRODUCT_EXTRA_KEY, "0");
    localStorage.setItem(HOLE_EXTRA_KEY, "0");
    localStorage.setItem(CHIMNEY_EXTRA_KEY, "0");
    localStorage.setItem(PRICE_KEY, String(calcTotal()));

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        buttons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        const type = btn.dataset.type; // new / replace

        // ✅ 최종요약은 gas_type을 읽음: lng / lpg
        const gasType = type === "new" ? "lng" : "lpg";

        // 기존 키도 호환용으로 같이 유지
        localStorage.setItem("install_type", type);
        localStorage.setItem("gas_type", gasType);

        // 도시/LPG 선택은 금액 영향 없음 → 합산값 그대로
        localStorage.setItem(PRICE_KEY, String(calcTotal()));

        const nextUrl = "installation_dryer2.html";

        pushHistory(
          `건조기 타입: ${type === "new" ? "도시" : "LPG"}`,
          nextUrl
        );

        location.href = nextUrl;
      });
    });

    prevBtn.addEventListener("click", (e) => {
      e.preventDefault();
      location.href = "maps.html";
    });
  </script>
</body>
</html>
